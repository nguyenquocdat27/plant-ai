<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Plant AI</title>

  <!-- TensorFlow -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

  <style>
    body {
      font-family: Arial;
      background: #e8f5e9;
      margin: 0;
      padding: 10px;
      text-align: center;
    }

    h1 {
      margin-bottom: 10px;
    }

    /* ===== TR·∫†NG TH√ÅI 1 ===== */
    #input-stage {
      background: #2e7d32;
      color: white;
      padding: 20px;
      border-radius: 16px;
    }

    #input-stage input {
      width: 90%;
      max-width: 300px;
      padding: 12px;
      margin: 8px 0;
      border-radius: 20px;
      border: none;
      font-size: 16px;
    }

    /* ===== TR·∫†NG TH√ÅI 2 ===== */
    #result-stage {
      display: none;
      margin-top: 15px;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    img {
      max-width: 180px;
      border-radius: 12px;
    }

    .chip {
      background: #c8fca2;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 14px;
      margin: 4px;
      display: inline-block;
    }

    #advice-box {
      background: #f1f8e9;
      border-radius: 16px;
      padding: 15px;
      margin-top: 12px;
      text-align: left;
      font-size: 14px;
      white-space: pre-line;
    }
  </style>
</head>

<body>

  <h1>üå± Plant AI</h1>

  <!-- ===== TR·∫†NG TH√ÅI TR∆Ø·ªöC NH·∫¨P ===== -->
  <div id="input-stage">
    <input type="file" accept="image/*" onchange="loadImage(event)">
    <input type="number" id="temp" placeholder="üå°Ô∏è Nhi·ªát ƒë·ªô ƒë·∫•t (¬∞C)">
    <input type="number" id="moisture" placeholder="üíß ƒê·ªô ·∫©m ƒë·∫•t (%)">
    <p>üì∑ Ch·ªçn ·∫£nh l√° + nh·∫≠p d·ªØ li·ªáu ƒë·ªÉ ph√¢n t√≠ch</p>
  </div>

  <!-- ===== TR·∫†NG TH√ÅI SAU K·∫æT QU·∫¢ ===== -->
  <div id="result-stage">
    <div class="row">
      <img id="preview">
      <div>
        <div class="chip" id="leafResult"></div>
        <div class="chip" id="tempChip"></div>
        <div class="chip" id="moistureChip"></div>
      </div>
    </div>

    <div id="advice-box"></div>
  </div>

  <script>
    const MODEL_URL = "./";
    let model;

    async function init() {
      model = await tmImage.load(
        MODEL_URL + "model.json",
        MODEL_URL + "metadata.json"
      );
      console.log("Model loaded");
    }

    function evaluatePlant(status, temp, moisture) {
      let advice = "";

      if (status.includes("v√†ng")) {
        advice += "üçÇ V√†ng l√° / h√©o r≈©:\n";
        advice += "- C√≥ th·ªÉ thi·∫øu dinh d∆∞·ª°ng ho·∫∑c r·ªÖ b·ªã t·ªïn th∆∞∆°ng.\n";
        advice += "- N√™n ki·ªÉm tra ƒë·∫•t v√† b√≥n ph√¢n h·ªØu c∆°.\n\n";
      }

      if (status.includes("ƒë·ªëm")) {
        advice += "ü¶† ƒê·ªëm l√°:\n";
        advice += "- Nguy c∆° b·ªánh n·∫•m/vi khu·∫©n.\n";
        advice += "- C·∫Øt l√° b·ªánh, h·∫°n ch·∫ø t∆∞·ªõi l√™n l√°.\n\n";
      }

      if (status.includes("ch√°y")) {
        advice += "üî• Ch√°y l√°:\n";
        advice += "- C√≥ th·ªÉ do n·∫Øng g·∫Øt ho·∫∑c thi·∫øu n∆∞·ªõc.\n";
        advice += "- Che n·∫Øng, t∆∞·ªõi ƒë·ªÅu.\n\n";
      }

      if (temp > 35) advice += "üå°Ô∏è Nhi·ªát ƒë·ªô cao ‚Üí che ph·ªß ƒë·∫•t.\n";
      if (temp < 15) advice += "üå°Ô∏è Nhi·ªát ƒë·ªô th·∫•p ‚Üí gi·∫£m t∆∞·ªõi.\n";
      if (moisture < 40) advice += "üíß ƒê·ªô ·∫©m th·∫•p ‚Üí c√¢y thi·∫øu n∆∞·ªõc.\n";
      if (moisture > 80) advice += "üíß ƒê·ªô ·∫©m cao ‚Üí nguy c∆° th·ªëi r·ªÖ.\n";

      return advice || "üåø C√¢y ƒëang trong t√¨nh tr·∫°ng t·ªët.";
    }

    async function loadImage(event) {
      if (!model) await init();

      const img = document.getElementById("preview");
      img.src = window.URL.createObjectURL(event.target.files[0]);

      img.onload = async () => {
        const prediction = await model.predict(img);
        let best = prediction[0];

        for (let p of prediction) {
          if (p.probability > best.probability) best = p;
        }

        const temp = document.getElementById("temp").value;
        const moisture = document.getElementById("moisture").value;

        document.getElementById("input-stage").style.display = "none";
        document.getElementById("result-stage").style.display = "block";

        document.getElementById("leafResult").innerText =
          `üåø ${best.className} (${(best.probability*100).toFixed(1)}%)`;

        document.getElementById("tempChip").innerText = `üå°Ô∏è ${temp}¬∞C`;
        document.getElementById("moistureChip").innerText = `üíß ${moisture}%`;

        document.getElementById("advice-box").innerText =
          evaluatePlant(best.className.toLowerCase(), temp, moisture);
      };
    }
  </script>

</body>
</html>



<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Plant AI</title>

<!-- TensorFlow -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

<style>
body {
  margin: 0;
  padding: 14px;
  font-family: Arial, sans-serif;
  background: #1b8f4b;
  color: #fff;
  text-align: center;
}

h1 {
  font-size: 34px;
  margin-bottom: 14px;
}

/* ===== INPUT STAGE ===== */
#input-stage {
  background: #147a3a;
  padding: 22px;
  border-radius: 24px;
}

input[type="file"],
input[type="number"] {
  width: 100%;
  max-width: 380px;
  padding: 20px;
  margin: 12px auto;
  border-radius: 30px;
  border: none;
  font-size: 22px;
  display: block;
}

/* ===== RESULT STAGE ===== */
#result-stage {
  display: none;
}

img {
  width: 100%;
  max-width: 330px;
  border-radius: 18px;
  margin: 16px auto;
}

/* K·∫øt qu·∫£ l√° */
#leafResult {
  font-size: 24px;
  font-weight: bold;
  margin: 12px 0;
}

/* Nhi·ªát ƒë·ªô & ƒë·ªô ·∫©m */
.env-box {
  background: #b6ff7a;
  color: #000;
  padding: 20px;
  border-radius: 22px;
  margin: 10px auto;
  font-size: 22px;
  font-weight: bold;
  max-width: 360px;
}

/* ===== ƒê√ÅNH GI√Å ===== */
#advice-box {
  background: #eaffd0;
  color: #000;
  padding: 24px;
  border-radius: 24px;
  margin: 20px auto;
  font-size: 20px;
  text-align: center;
  white-space: pre-line;
  max-width: 420px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.2);
}
</style>
</head>

<body>

<h1>üå± Plant AI</h1>

<!-- ===== TR∆Ø·ªöC KHI NH·∫¨P ===== -->
<div id="input-stage">
  <input type="file" accept="image/*" onchange="loadImage(event)">
  <input type="number" id="temp" placeholder="üå°Ô∏è Nhi·ªát ƒë·ªô ƒë·∫•t (¬∞C)">
  <input type="number" id="moisture" placeholder="üíß ƒê·ªô ·∫©m ƒë·∫•t (%)">
  <p style="font-size:18px;">üì∏ Ch·ªçn ·∫£nh + nh·∫≠p d·ªØ li·ªáu ƒë·ªÉ AI ph√¢n t√≠ch</p>
</div>

<!-- ===== SAU KHI C√ì K·∫æT QU·∫¢ ===== -->
<div id="result-stage">
  <img id="preview">
  <div id="leafResult"></div>

  <div class="env-box" id="tempBox"></div>
  <div class="env-box" id="moistureBox"></div>

  <div id="advice-box"></div>
</div>

<script>
const MODEL_URL = "./";
let model;

async function init() {
  model = await tmImage.load(
    MODEL_URL + "model.json",
    MODEL_URL + "metadata.json"
  );
}

/* ===== ƒê√ÅNH GI√Å T·ªîNG H·ª¢P ===== */
function evaluatePlant(status, temp, moisture) {
  let text = "üß† ƒê√ÅNH GI√Å T·ªîNG H·ª¢P\n\n";

  /* Ph√¢n t√≠ch l√° */
  if (status.includes("t·ªët")) {
    text += "üåø L√° kh·ªèe, m√†u s·∫Øc ·ªïn ƒë·ªãnh.\n";
  }

  if (status.includes("v√†ng")) {
    text += "üçÇ L√° v√†ng / h√©o ‚Üí r·ªÖ h·∫•p thu k√©m ho·∫∑c thi·∫øu dinh d∆∞·ª°ng.\n";
  }

  if (status.includes("ƒë·ªëm")) {
    text += "ü¶† C√≥ ƒë·ªëm l√° ‚Üí nguy c∆° b·ªánh n·∫•m.\n";
  }

  if (status.includes("ch√°y")) {
    text += "üî• M√©p l√° ch√°y ‚Üí stress nhi·ªát ho·∫∑c thi·∫øu n∆∞·ªõc.\n";
  }

  text += "\nüìä PH√ÇN T√çCH M√îI TR∆Ø·ªúNG\n";

  if (temp > 35) {
    text += "üå°Ô∏è Nhi·ªát ƒë·ªô r·∫•t cao ‚Üí c√¢y d·ªÖ s·ªëc nhi·ªát.\n";
  } else if (temp < 15) {
    text += "üå°Ô∏è Nhi·ªát ƒë·ªô th·∫•p ‚Üí c√¢y sinh tr∆∞·ªüng ch·∫≠m.\n";
  } else {
    text += "üå°Ô∏è Nhi·ªát ƒë·ªô ph√π h·ª£p.\n";
  }

  if (moisture < 40) {
    text += "üíß ƒê·ªô ·∫©m th·∫•p ‚Üí c√¢y thi·∫øu n∆∞·ªõc.\n";
  } else if (moisture > 80) {
    text += "üíß ƒê·ªô ·∫©m cao ‚Üí nguy c∆° th·ªëi r·ªÖ.\n";
  } else {
    text += "üíß ƒê·ªô ·∫©m ·ªïn ƒë·ªãnh.\n";
  }

  text += "\n‚ö†Ô∏è CH·∫®N ƒêO√ÅN\n";

  if (status.includes("ch√°y") && temp > 35 && moisture < 40) {
    text += "üëâ C√¢y ƒëang b·ªã STRESS NHI·ªÜT + THI·∫æU N∆Ø·ªöC nghi√™m tr·ªçng.\n";
  } else if (status.includes("ƒë·ªëm") && moisture > 70) {
    text += "üëâ ƒêi·ªÅu ki·ªán thu·∫≠n l·ª£i cho N·∫§M B·ªÜNH ph√°t tri·ªÉn.\n";
  } else {
    text += "üëâ C√¢y c√≥ kh·∫£ nƒÉng ph·ª•c h·ªìi t·ªët n·∫øu chƒÉm s√≥c ƒë√∫ng.\n";
  }

  text += "\n‚úÖ KHUY·∫æN NGH·ªä\n";
  text += "‚Ä¢ T∆∞·ªõi n∆∞·ªõc v√†o s√°ng s·ªõm\n";
  text += "‚Ä¢ Che g·ªëc, ph·ªß r∆°m gi·ªØ ·∫©m\n";
  text += "‚Ä¢ Theo d√µi l√° m·ªõi trong 3‚Äì5 ng√†y\n";

  return text;
}

/* ===== LOAD ·∫¢NH ===== */
async function loadImage(event) {
  if (!model) await init();

  const img = document.getElementById("preview");
  img.src = URL.createObjectURL(event.target.files[0]);

  img.onload = async () => {
    const pred = await model.predict(img);
    let best = pred.reduce((a,b)=>a.probability>b.probability?a:b);

    const temp = Number(document.getElementById("temp").value);
    const moisture = Number(document.getElementById("moisture").value);

    document.getElementById("input-stage").style.display = "none";
    document.getElementById("result-stage").style.display = "block";

    document.getElementById("leafResult").innerText =
      `üåø ${best.className} (${(best.probability*100).toFixed(1)}%)`;

    document.getElementById("tempBox").innerText =
      `üå°Ô∏è Nhi·ªát ƒë·ªô: ${temp} ¬∞C`;

    document.getElementById("moistureBox").innerText =
      `üíß ƒê·ªô ·∫©m: ${moisture} %`;

    document.getElementById("advice-box").innerText =
      evaluatePlant(best.className.toLowerCase(), temp, moisture);
  };
}
</script>

</body>
</html>

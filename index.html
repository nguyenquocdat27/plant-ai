<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Plant AI</title>

<!-- TensorFlow -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

<style>
body {
  margin: 0;
  padding: 14px;
  font-family: Arial, sans-serif;
  background: #1b8f4b;
  color: #fff;
  text-align: center;
}

h1 {
  font-size: 34px;
  margin-bottom: 14px;
}

#input-stage {
  background: #147a3a;
  padding: 22px;
  border-radius: 24px;
}

input[type="file"],
input[type="number"] {
  width: 100%;
  max-width: 380px;
  padding: 20px;
  margin: 12px auto;
  border-radius: 30px;
  border: none;
  font-size: 22px;
  display: block;
}

#result-stage {
  display: none;
}

img {
  width: 100%;
  max-width: 330px;
  border-radius: 18px;
  margin: 16px auto;
}

#leafResult {
  font-size: 24px;
  font-weight: bold;
  margin: 12px 0;
}

.env-box {
  background: #b6ff7a;
  color: #000;
  padding: 20px;
  border-radius: 22px;
  margin: 10px auto;
  font-size: 22px;
  font-weight: bold;
  max-width: 360px;
}

#advice-box {
  background: #eaffd0;
  color: #000;
  padding: 24px;
  border-radius: 24px;
  margin: 20px auto;
  font-size: 20px;
  white-space: pre-line;
  max-width: 440px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.2);
}
</style>
</head>

<body>

<h1>üå± Plant AI</h1>

<div id="input-stage">
  <input type="file" accept="image/*" onchange="loadImage(event)">
  <input type="number" id="temp" placeholder="üå°Ô∏è Nhi·ªát ƒë·ªô ƒë·∫•t (¬∞C)">
  <input type="number" id="moisture" placeholder="üíß ƒê·ªô ·∫©m ƒë·∫•t (%)">
  <p style="font-size:18px;">üì∏ Ch·ªçn ·∫£nh v√† nh·∫≠p d·ªØ li·ªáu ƒë·ªÉ AI ph√¢n t√≠ch</p>
</div>

<div id="result-stage">
  <img id="preview">
  <div id="leafResult"></div>

  <div class="env-box" id="tempBox"></div>
  <div class="env-box" id="moistureBox"></div>

  <div id="advice-box"></div>
</div>

<script>
const MODEL_URL = "./";
let model;

async function init() {
  model = await tmImage.load(
    MODEL_URL + "model.json",
    MODEL_URL + "metadata.json"
  );
}

function evaluatePlant(status, temp, moisture) {
  let text = "";

  /* ===== L√Å C√ÇY ===== */
  text += "üß† ƒê√ÅNH GI√Å T·ª™ L√Å C√ÇY\n";
  if (status.includes("t·ªët"))
    text += "üåø L√° kh·ªèe, m√†u s·∫Øc ·ªïn ƒë·ªãnh.\n";
  if (status.includes("v√†ng"))
    text += "üçÇ L√° v√†ng/h√©o ‚Üí thi·∫øu dinh d∆∞·ª°ng ho·∫∑c r·ªÖ y·∫øu.\n";
  if (status.includes("ƒë·ªëm"))
    text += "ü¶† ƒê·ªëm l√° ‚Üí nghi ng·ªù n·∫•m ho·∫∑c vi khu·∫©n.\n";
  if (status.includes("ch√°y"))
    text += "üî• M√©p l√° ch√°y ‚Üí stress nhi·ªát ho·∫∑c thi·∫øu n∆∞·ªõc.\n";

  /* ===== M√îI TR∆Ø·ªúNG ===== */
  text += "\nüìä ƒê√ÅNH GI√Å M√îI TR∆Ø·ªúNG\n";
  if (temp > 35) text += "üå°Ô∏è Nhi·ªát ƒë·ªô cao ‚Üí d·ªÖ s·ªëc nhi·ªát.\n";
  else if (temp < 15) text += "üå°Ô∏è Nhi·ªát ƒë·ªô th·∫•p ‚Üí c√¢y ph√°t tri·ªÉn ch·∫≠m.\n";
  else text += "üå°Ô∏è Nhi·ªát ƒë·ªô ph√π h·ª£p.\n";

  if (moisture < 40) text += "üíß ƒê·ªô ·∫©m th·∫•p ‚Üí c√¢y thi·∫øu n∆∞·ªõc.\n";
  else if (moisture > 80) text += "üíß ƒê·ªô ·∫©m cao ‚Üí nguy c∆° √∫ng r·ªÖ.\n";
  else text += "üíß ƒê·ªô ·∫©m ·ªïn ƒë·ªãnh.\n";

  /* ===== CH·∫®N ƒêO√ÅN ===== */
  text += "\n‚ö†Ô∏è CH·∫®N ƒêO√ÅN T·ªîNG H·ª¢P\n";

  let heatStress = status.includes("ch√°y") && temp > 35 && moisture < 40;
  let fungalRisk = status.includes("ƒë·ªëm") && moisture > 70;

  if (heatStress)
    text += "üëâ Stress nhi·ªát k·∫øt h·ª£p thi·∫øu n∆∞·ªõc.\n";
  else if (fungalRisk)
    text += "üëâ M√¥i tr∆∞·ªùng thu·∫≠n l·ª£i cho b·ªánh n·∫•m.\n";
  else
    text += "üëâ C√¢y t∆∞∆°ng ƒë·ªëi ·ªïn ƒë·ªãnh.\n";

  /* ===== NGUY√äN NH√ÇN ===== */
  text += "\nüß¨ NGUY√äN NH√ÇN SINH H·ªåC\n";
  if (heatStress) {
    text += "- Tho√°t h∆°i n∆∞·ªõc m·∫°nh qua l√°\n";
    text += "- R·ªÖ kh√¥ng h√∫t ƒë·ªß n∆∞·ªõc\n";
    text += "- T·∫ø b√†o l√° b·ªã t·ªïn th∆∞∆°ng nhi·ªát\n";
  } else if (fungalRisk) {
    text += "- ƒê·ªô ·∫©m cao k√©o d√†i\n";
    text += "- B√†o t·ª≠ n·∫•m ph√°t tri·ªÉn m·∫°nh\n";
  } else {
    text += "- Qu√° tr√¨nh sinh l√Ω ·ªïn ƒë·ªãnh\n";
  }

  /* ===== GI·∫¢I PH√ÅP ===== */
  text += "\nüõ†Ô∏è GI·∫¢I PH√ÅP TH·ª∞C T·∫æ\n";
  if (heatStress) {
    text += "- T∆∞·ªõi n∆∞·ªõc s√°ng s·ªõm/chi·ªÅu m√°t\n";
    text += "- Che n·∫Øng t·∫°m th·ªùi\n";
    text += "- Ph·ªß g·ªëc gi·ªØ ·∫©m\n";
  } else if (fungalRisk) {
    text += "- C·∫Øt b·ªè l√° b·ªánh\n";
    text += "- Gi·∫£m t∆∞·ªõi n∆∞·ªõc l√™n l√°\n";
    text += "- TƒÉng th√¥ng tho√°ng\n";
  } else {
    text += "- Duy tr√¨ chƒÉm s√≥c hi·ªán t·∫°i\n";
  }

  return text;
}

async function loadImage(event) {
  if (!model) await init();

  const img = document.getElementById("preview");
  img.src = URL.createObjectURL(event.target.files[0]);

  img.onload = async () => {
    const pred = await model.predict(img);
    let best = pred.reduce((a,b)=>a.probability>b.probability?a:b);

    const temp = Number(document.getElementById("temp").value);
    const moisture = Number(document.getElementById("moisture").value);

    document.getElementById("input-stage").style.display = "none";
    document.getElementById("result-stage").style.display = "block";

    document.getElementById("leafResult").innerText =
      `üåø ${best.className} (${(best.probability*100).toFixed(1)}%)`;

    document.getElementById("tempBox").innerText =
      `üå°Ô∏è Nhi·ªát ƒë·ªô: ${temp} ¬∞C`;

    document.getElementById("moistureBox").innerText =
      `üíß ƒê·ªô ·∫©m: ${moisture} %`;

    document.getElementById("advice-box").innerText =
      evaluatePlant(best.className.toLowerCase(), temp, moisture);
  };
}
</script>

</body>
</html>

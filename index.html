<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plant AI</title>

<!-- TensorFlow -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

<style>
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #178a45;
  color: #fff;
  text-align: center;
}

/* ===== HEADER ===== */
header {
  padding: 22px 12px;
  font-size: 34px;
  font-weight: bold;
}

/* ===== KHUNG CH√çNH ===== */
#input-stage {
  background: #147a3a;
  margin: 0 auto;
  width: 92%;
  max-width: 420px;
  padding: 26px 20px 40px;
  border-radius: 26px;
  min-height: 65vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

/* ===== FILE INPUT (·∫®N √î TR·∫ÆNG) ===== */
.file-label {
  background: #1faa59;
  padding: 22px;
  border-radius: 30px;
  font-size: 22px;
  font-weight: bold;
  cursor: pointer;
  margin-bottom: 20px;
}

.file-label input {
  display: none;
}

/* ===== INPUT ===== */
input[type="number"] {
  width: 100%;
  padding: 22px;
  margin-bottom: 18px;
  border-radius: 30px;
  border: none;
  font-size: 22px;
}

/* ===== H∆Ø·ªöNG D·∫™N ===== */
#hint {
  margin-top: 10px;
  font-size: 20px;
  opacity: 0.95;
}

/* ===== K·∫æT QU·∫¢ ===== */
#result-stage {
  display: none;
  padding: 20px;
}

img {
  width: 100%;
  max-width: 320px;
  border-radius: 20px;
  margin: 18px auto;
}

#leafResult {
  font-size: 26px;
  font-weight: bold;
  margin-bottom: 14px;
}

.env-box {
  background: #caff9a;
  color: #000;
  padding: 22px;
  border-radius: 22px;
  margin: 12px auto;
  font-size: 22px;
  font-weight: bold;
  max-width: 360px;
}

/* ===== ƒê√ÅNH GI√Å ===== */
#advice-box {
  background: #f1ffe0;
  color: #000;
  padding: 24px;
  border-radius: 24px;
  margin: 20px auto;
  font-size: 20px;
  white-space: pre-line;
  max-width: 420px;
}
</style>
</head>

<body>

<header>üå± Plant AI</header>

<!-- ===== NH·∫¨P D·ªÆ LI·ªÜU ===== -->
<div id="input-stage">

  <label class="file-label">
    üì∑ Ch·ªçn ·∫£nh l√° c√¢y
    <input type="file" accept="image/*" onchange="loadImage(event)">
  </label>

  <input type="number" id="temp" placeholder="üå°Ô∏è Nhi·ªát ƒë·ªô ƒë·∫•t (¬∞C)">
  <input type="number" id="moisture" placeholder="üíß ƒê·ªô ·∫©m ƒë·∫•t (%)">

  <div id="hint">
    Ch·ªçn ·∫£nh v√† nh·∫≠p d·ªØ li·ªáu<br>
    ƒë·ªÉ AI ph√¢n t√≠ch t√¨nh tr·∫°ng c√¢y
  </div>

</div>

<!-- ===== K·∫æT QU·∫¢ ===== -->
<div id="result-stage">
  <img id="preview">
  <div id="leafResult"></div>

  <div class="env-box" id="tempBox"></div>
  <div class="env-box" id="moistureBox"></div>

  <div id="advice-box"></div>
</div>

<script>
const MODEL_URL = "./";
let model;

async function init() {
  model = await tmImage.load(
    MODEL_URL + "model.json",
    MODEL_URL + "metadata.json"
  );
}

/* ===== ƒê√ÅNH GI√Å ===== */
function evaluatePlant(status, temp, moisture) {
  let text = "üß† ƒê√ÅNH GI√Å T·ªîNG H·ª¢P\n\n";

  if (status.includes("t·ªët")) {
    text += "üåø L√° kh·ªèe m·∫°nh, ph√°t tri·ªÉn ·ªïn ƒë·ªãnh.\n";
  }
  if (status.includes("v√†ng")) {
    text += "üçÇ L√° v√†ng ‚Üí thi·∫øu dinh d∆∞·ª°ng ho·∫∑c r·ªÖ y·∫øu.\n";
  }
  if (status.includes("ƒë·ªëm")) {
    text += "ü¶† L√° c√≥ ƒë·ªëm ‚Üí nguy c∆° b·ªánh n·∫•m.\n";
  }
  if (status.includes("ch√°y")) {
    text += "üî• M√©p l√° ch√°y ‚Üí stress nhi·ªát ho·∫∑c thi·∫øu n∆∞·ªõc.\n";
  }

  text += "\nüìä M√îI TR∆Ø·ªúNG\n";

  if (temp > 35) text += "üå°Ô∏è Nhi·ªát ƒë·ªô cao, c√¢y d·ªÖ s·ªëc nhi·ªát.\n";
  else if (temp < 15) text += "üå°Ô∏è Nhi·ªát ƒë·ªô th·∫•p, c√¢y sinh tr∆∞·ªüng ch·∫≠m.\n";
  else text += "üå°Ô∏è Nhi·ªát ƒë·ªô ph√π h·ª£p.\n";

  if (moisture < 40) text += "üíß ƒê·ªô ·∫©m th·∫•p, c√¢y thi·∫øu n∆∞·ªõc.\n";
  else if (moisture > 80) text += "üíß ƒê·ªô ·∫©m cao, d·ªÖ th·ªëi r·ªÖ.\n";
  else text += "üíß ƒê·ªô ·∫©m ·ªïn ƒë·ªãnh.\n";

  text += "\nüõ†Ô∏è GI·∫¢I PH√ÅP TH·ª∞C T·∫æ\n";

  if (status.includes("ch√°y")) {
    text += "‚Ä¢ Che n·∫Øng, t∆∞·ªõi n∆∞·ªõc s√°ng s·ªõm\n";
  }
  if (status.includes("ƒë·ªëm")) {
    text += "‚Ä¢ C·∫Øt l√° b·ªánh, h·∫°n ch·∫ø t∆∞·ªõi l√°\n";
  }
  if (status.includes("v√†ng")) {
    text += "‚Ä¢ B·ªï sung ph√¢n h·ªØu c∆°, ki·ªÉm tra r·ªÖ\n";
  }

  text += "‚Ä¢ Theo d√µi c√¢y 3‚Äì5 ng√†y ti·∫øp theo";

  return text;
}

/* ===== LOAD ·∫¢NH ===== */
async function loadImage(event) {
  if (!model) await init();

  const img = document.getElementById("preview");
  img.src = URL.createObjectURL(event.target.files[0]);

  img.onload = async () => {
    const pred = await model.predict(img);
    let best = pred.reduce((a, b) =>
      a.probability > b.probability ? a : b
    );

    const temp = Number(document.getElementById("temp").value);
    const moisture = Number(document.getElementById("moisture").value);

    document.getElementById("input-stage").style.display = "none";
    document.getElementById("result-stage").style.display = "block";

    document.getElementById("leafResult").innerText =
      `üåø ${best.className} (${(best.probability * 100).toFixed(1)}%)`;

    document.getElementById("tempBox").innerText =
      `üå°Ô∏è Nhi·ªát ƒë·ªô: ${temp} ¬∞C`;

    document.getElementById("moistureBox").innerText =
      `üíß ƒê·ªô ·∫©m: ${moisture} %`;

    document.getElementById("advice-box").innerText =
      evaluatePlant(best.className.toLowerCase(), temp, moisture);
  };
}
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Plant AI</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

<style>
body {
  margin: 0;
  padding: 12px;
  font-family: Arial, sans-serif;
  background: #1b8f4b;
  color: #fff;
  text-align: center;
}

h1 {
  font-size: 32px;
  margin-bottom: 10px;
}

/* ===== INPUT STAGE ===== */
#input-stage {
  background: #147a3a;
  padding: 20px;
  border-radius: 20px;
}

input[type="file"],
input[type="number"] {
  width: 100%;
  max-width: 360px;
  padding: 18px;
  margin: 10px auto;
  border-radius: 30px;
  border: none;
  font-size: 20px;
  display: block;
}

/* ===== RESULT STAGE ===== */
#result-stage {
  display: none;
}

img {
  width: 100%;
  max-width: 320px;
  border-radius: 16px;
  margin: 15px auto;
}

/* Káº¿t quáº£ lÃ¡ */
#leafResult {
  font-size: 22px;
  margin: 10px 0;
}

/* Nhiá»‡t Ä‘á»™ & Ä‘á»™ áº©m to */
.env-box {
  background: #b6ff7a;
  color: #000;
  padding: 18px;
  border-radius: 20px;
  margin: 10px 0;
  font-size: 22px;
  font-weight: bold;
}

/* Lá»i khuyÃªn */
#advice-box {
  background: #eaffd0;
  color: #000;
  padding: 20px;
  border-radius: 20px;
  margin-top: 15px;
  font-size: 18px;
  text-align: left;
  white-space: pre-line;
}
</style>
</head>

<body>

<h1>ğŸŒ± Plant AI</h1>

<!-- ===== BEFORE ===== -->
<div id="input-stage">
  <input type="file" accept="image/*" onchange="loadImage(event)">
  <input type="number" id="temp" placeholder="ğŸŒ¡ï¸ Nhiá»‡t Ä‘á»™ Ä‘áº¥t (Â°C)">
  <input type="number" id="moisture" placeholder="ğŸ’§ Äá»™ áº©m Ä‘áº¥t (%)">
  <p style="font-size:18px;">ğŸ“¸ Chá»n áº£nh + nháº­p dá»¯ liá»‡u Ä‘á»ƒ phÃ¢n tÃ­ch</p>
</div>

<!-- ===== AFTER ===== -->
<div id="result-stage">
  <img id="preview">
  <div id="leafResult"></div>

  <div class="env-box" id="tempBox"></div>
  <div class="env-box" id="moistureBox"></div>

  <div id="advice-box"></div>
</div>

<script>
const MODEL_URL = "./";
let model;

async function init() {
  model = await tmImage.load(
    MODEL_URL + "model.json",
    MODEL_URL + "metadata.json"
  );
}

function evaluatePlant(status, temp, moisture) {
  let a = "";

  if (status.includes("vÃ ng")) {
    a += "ğŸ‚ VÃ€NG LÃ / HÃ‰O RÅ¨\n";
    a += "- Thiáº¿u dinh dÆ°á»¡ng hoáº·c rá»… yáº¿u\n";
    a += "- BÃ³n phÃ¢n há»¯u cÆ¡, kiá»ƒm tra Ä‘áº¥t\n\n";
  }

  if (status.includes("Ä‘á»‘m")) {
    a += "ğŸ¦  Äá»M LÃ\n";
    a += "- CÃ³ kháº£ nÄƒng bá»‡nh náº¥m\n";
    a += "- Cáº¯t lÃ¡ bá»‡nh, trÃ¡nh áº©m cao\n\n";
  }

  if (status.includes("chÃ¡y")) {
    a += "ğŸ”¥ CHÃY LÃ\n";
    a += "- Do náº¯ng gáº¯t hoáº·c thiáº¿u nÆ°á»›c\n";
    a += "- Che náº¯ng, tÆ°á»›i Ä‘á»u\n\n";
  }

  if (temp > 35) a += "ğŸŒ¡ï¸ Nhiá»‡t Ä‘á»™ cao â†’ che phá»§ Ä‘áº¥t\n";
  if (temp < 15) a += "ğŸŒ¡ï¸ Nhiá»‡t Ä‘á»™ tháº¥p â†’ giáº£m tÆ°á»›i\n";
  if (moisture < 40) a += "ğŸ’§ Äá»™ áº©m tháº¥p â†’ cÃ¢y thiáº¿u nÆ°á»›c\n";
  if (moisture > 80) a += "ğŸ’§ Äá»™ áº©m cao â†’ nguy cÆ¡ thá»‘i rá»…\n";

  return a || "ğŸŒ¿ CÃ¢y Ä‘ang phÃ¡t triá»ƒn tá»‘t.";
}

async function loadImage(event) {
  if (!model) await init();

  const img = document.getElementById("preview");
  img.src = URL.createObjectURL(event.target.files[0]);

  img.onload = async () => {
    const pred = await model.predict(img);
    let best = pred.reduce((a,b)=>a.probability>b.probability?a:b);

    const temp = Number(document.getElementById("temp").value);
    const moisture = Number(document.getElementById("moisture").value);

    document.getElementById("input-stage").style.display = "none";
    document.getElementById("result-stage").style.display = "block";

    document.getElementById("leafResult").innerText =
      `ğŸŒ¿ ${best.className} (${(best.probability*100).toFixed(1)}%)`;

    document.getElementById("tempBox").innerText = `ğŸŒ¡ï¸ Nhiá»‡t Ä‘á»™: ${temp} Â°C`;
    document.getElementById("moistureBox").innerText = `ğŸ’§ Äá»™ áº©m: ${moisture} %`;

    document.getElementById("advice-box").innerText =
      evaluatePlant(best.className.toLowerCase(), temp, moisture);
  };
}
</script>

</body>
</html>
